create database CAMILLAS_DB;

Create schema CORTEX_ANALYST;

DROP schema public;

create warehouse LLM_WH;


create or replace table camillas_db.cortex_analyst.camillas_teams
( 
    team_id number,
    team_name varchar(50),
    kit_color varchar(20),
    coach varchar(100),
    emoji_symbol varchar(5)
);

insert into camillas_db.cortex_analyst.camillas_teams
values
(1,'Blue Sky Strikers','cerulean','Stormy McLeod', 'ðŸ’™â˜ï¸âš¡ï¸'),
(2,'Pitch Blazing Bombers','emerald','Kelly Groen','ðŸŒ±ðŸ”¥ðŸ’£' ),
(3,'Solar Flashing Flares','marigold','Ravi Bahsin', 'â˜€ï¸ðŸ”¥'),
(4,'Terracotta Tirade','terracotta','Clay SkÃ¡la', 'ðŸª´ðŸ’ª');


create or replace table camillas_db.cortex_analyst.match_locations
(
 location_id number, 
 location_name varchar(50)
);

insert into camillas_db.cortex_analyst.match_locations
values 
(1, 'Main Street Park - Pitch 1'),
(2, 'Main Street Park - Pitch 2'),
(3, 'Central Park - North Pitch'),
(4, 'Central Park - South Pitch');

create or replace table camillas_db.cortex_analyst.match_schedule
( 
    home_team_id number,
    away_team_id number,
    location_id number,
    match_datetime timestamp_ntz  
);

insert into camillas_db.cortex_analyst.match_schedule
values
(1,2,1,'2025-06-07 08:00:00'),
(3,4,2,'2025-06-07 08:00:00'),
(2,3,3,'2025-06-07 12:00:00'),
(1,4,4,'2025-06-07 12:00:00'),
(1,3,1,'2025-06-07 16:00:00'),
(2,4,2,'2025-06-07 16:00:00')
;

create schema FORECASTING;

create warehouse ML_WH;

create or replace table camillas_db.forecasting.practice_stats (
	practice_date timestamp_ntz,
	goals_scored number,
	goals_attempted number
);


CREATE OR REPLACE FILE FORMAT my_csv_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1;


select $1, $1, $3
from @CAMILLAS_FOOTBALL/stats_collected_at_practice.csv
(file_format => my_csv_format);


COPY INTO camillas_db.forecasting.practice_stats
FROM (
  SELECT
    $1::TIMESTAMP_NTZ,
    $2::NUMBER,
    $3::NUMBER
  FROM @CAMILLAS_FOOTBALL/stats_collected_at_practice.csv
  (FILE_FORMAT => my_csv_format)
);

select * from camillas_db.forecasting.practice_stats;

select min(practice_date) from camillas_db.forecasting.practice_stats;

select max(practice_date) from camillas_db.forecasting.practice_stats;


-- make a view that uses data from march to july for training the model 
create or replace view camillas_db.forecasting.train_model_practice_data(
	  practice_date,
	  goals_attempted,
	  goals_scored
) as
  select 
    practice_date, 
    goals_attempted,
    goals_scored
  from camillas_db.forecasting.practice_stats
  where practice_date < '2025-07-01';


-- make a view that uses data from july forward for validating the model
create or replace view camillas_db.forecasting.validate_model_practice_data(
	   practice_date,
	   goals_attempted,
	   goals_scored
) as
  select 
    practice_date, 
    goals_attempted,
    goals_scored
  from camillas_db.forecasting.practice_stats
  where practice_date >= '2025-07-01';


Select * from camillas_db.forecasting.validate_model_practice_data;

Select * from camillas_db.forecasting.train_model_practice_data;

list @camillas_db.cortex_analyst.cortex_analyst_model_stage;

create or replace view camillas_db.forecasting.train_2_model_practice_data(
	practice_date,
	day_of_week,
	goals_attempted,
	goals_scored
) as
select 
practice_date,
dayname(practice_date) as day_of_week,
goals_attempted,
goals_scored
from camillas_db.forecasting.practice_stats
where practice_date < '2025-07-01';



create or replace view camillas_db.forecasting.VALIDATE_2_MODEL_PRACTICE_DATA(
	practice_date,
	day_of_week,
	goals_attempted,
	goals_scored
) as
select 
practice_date,
dayname(practice_date) as day_of_week,
goals_attempted,
goals_scored
from camillas_db.forecasting.practice_stats
where practice_date >= '2025-07-01';

  

create schema CLASSIFICATION;

create or replace table camillas_db.classification.train_player_position (
	player_id number(38,0),
	position_code varchar(1),
	game number(38,0),
	minutes_played number(38,0),
	goals number(38,0),
	assists number(38,0),
	shots number(38,0),
	passes number(38,0),
	sprint_distance number(38,0),
	saves number(38,0),
	dribbles number(38,0),
	blocks number(38,0),
	claims number(38,0)
);

-- select appropriate schema
list @camillas_football;

select $1, $1, $3
from @CAMILLAS_FOOTBALL/train_player_positions.csv
(file_format => my_csv_format);


COPY INTO camillas_db.classification.train_player_position
(
  player_id,
  position_code,
  game,
  minutes_played,
  goals,
  assists,
  shots,
  passes,
  sprint_distance,
  saves,
  dribbles,
  blocks,
  claims
)
FROM (
  SELECT
    $1::NUMBER,
    $2::VARCHAR,
    $3::NUMBER,
    $4::NUMBER,
    $5::NUMBER,
    $6::NUMBER,
    $7::NUMBER,
    $8::NUMBER,
    $9::NUMBER,
    $10::NUMBER,
    $11::NUMBER,
    $12::NUMBER,
    $13::NUMBER
  FROM @CAMILLAS_FOOTBALL/train_player_positions.csv
)
FILE_FORMAT = (FORMAT_NAME = my_csv_format);


Select * from camillas_db.classification.train_player_position;


create or replace table camillas_db.classification.unclassified_player_positions (
	player_id number(38,0),
	game_id number(38,0),
	mins_played number(38,0),
	goals_made number(38,0),
	assists number(38,0),
	shots number(38,0),
	passes number(38,0),
	sprint_distance number(38,0),
	saves number(38,0),
	dribbles number(38,0),
	blocks number(38,0),
	claims number(38,0)
);


select $1, $1, $3
from @CAMILLAS_FOOTBALL/unclassified_player_data.csv
(file_format => my_csv_format);


COPY INTO camillas_db.classification.unclassified_player_positions
(
  player_id,
  game_id,
  mins_played,
  goals_made,
  assists,
  shots,
  passes,
  sprint_distance,
  saves,
  dribbles,
  blocks,
  claims
)
FROM (
  SELECT
    $1::NUMBER,   -- PLAYER
    $2::NUMBER,   -- GAME
    $3::NUMBER,   -- MINUTES_PLAYED
    $4::NUMBER,   -- GOALS
    $5::NUMBER,   -- ASSISTS
    $6::NUMBER,   -- SHOTS
    $7::NUMBER,   -- PASSES
    $8::NUMBER,   -- SPRINT_DISTANCE
    $9::NUMBER,   -- SAVES
    $10::NUMBER,  -- DRIBBLES
    $11::NUMBER,  -- BLOCKS
    $12::NUMBER   -- CLAIMS
  FROM @CAMILLAS_FOOTBALL/unclassified_player_data.csv
)
FILE_FORMAT = (FORMAT_NAME = my_csv_format);

